<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Výherní Automat</title>
  <style>
    body {
      background: #222;
      color: #fff;
      text-align: center;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      margin-bottom: 20px;
    }
    /* Zvětšený kontejner automatu */
    .slot-machine {
      margin: 20px auto;
      width: 600px;
    }
    .reels {
      display: flex;
      justify-content: center;
    }
    /* Zvětšené válce (150×150 px) */
    .reel {
      width: 150px;
      height: 150px;
      border: 2px solid #fff;
      margin: 0 10px;
      overflow: hidden;
      position: relative;
      background: #000;
    }
    .reel-inner {
      position: absolute;
      top: 0;
      left: 0;
    }
    .reel img {
      width: 150px;
      height: 150px;
      display: block;
    }
    /* Tlačítko – zvětšené, s větším písmem, větším paddingem a červeným pozadím */
    .spin-btn {
      padding: 15px 30px;
      font-size: 24px;
      margin-top: 20px;
      cursor: pointer;
      background: #ff0000;
      border: none;
      border-radius: 5px;
      color: #fff;
    }
    .spin-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .result {
      margin-top: 20px;
      font-size: 24px;
    }
    /* Vycentrovaný obrázek při výhře s vlnící animací */
    #prizeImage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 500px;
      display: none;
      z-index: 999;
      animation: wave 2s infinite;
    }
    /* Keyframes pro vlnící animaci */
    @keyframes wave {
      0% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
      25% { transform: translate(-50%, -50%) scale(1.1) rotate(5deg); }
      50% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
      75% { transform: translate(-50%, -50%) scale(1.1) rotate(-5deg); }
      100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
    }
    /* Kontejner pro gif pozadí – nyní bez atributu src a se zvýšeným z-indexem */
    #gifBackground {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      display: none;
    }
  </style>
</head>
<body>
  <h1>Zatoč si</h1>
  <div class="slot-machine">
    <div class="reels">
      <div class="reel" id="reel1">
        <div class="reel-inner"></div>
      </div>
      <div class="reel" id="reel2">
        <div class="reel-inner"></div>
      </div>
      <div class="reel" id="reel3">
        <div class="reel-inner"></div>
      </div>
    </div>
  </div>
  <!-- Text tlačítka změněn na "Mačkej!" -->
  <button class="spin-btn" id="spinBtn">Mačkej!</button>
  <div class="result" id="result"></div>
  <!-- Obrázek, který se zobrazí při výhře, vycentrovaný na obrazovce s animací -->
  <img id="prizeImage" src="voucher.png" alt="Gratulujeme, vyhrál(a) jsi!">
  <!-- Kontejner pro gif pozadí -->
  <div id="gifBackground"></div>
  <!-- Audio přehrávač – soubor se spustí od 1:05 (65 s) -->
  <audio id="prizeAudio" src="Spor - Obsession.mp3"></audio>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Pole obrázků symbolů (celkem 5)
      const symbols = ["crazy.gif", "yay.gif", "cat.gif", "exlplosion.gif", "kara.jpg"];
      
      let spinCount = 0;
      let finalIndices = [null, null, null];
      let reelsFinished = 0;
      // Výška symbolu – 150 px (kvůli zvětšeným válcům)
      const symbolHeight = 150;
      
      // Reference na elementy jednotlivých válců
      const reelElements = [
        document.getElementById("reel1").querySelector(".reel-inner"),
        document.getElementById("reel2").querySelector(".reel-inner"),
        document.getElementById("reel3").querySelector(".reel-inner")
      ];
      
      // Inicializace válců – pro plynulý posun použijeme dvakrát opakovaný seznam symbolů
      function initReels() {
        reelElements.forEach(function(reelInner) {
          reelInner.innerHTML = "";
          symbols.forEach(function(symbol) {
            const img = document.createElement("img");
            img.src = symbol;
            reelInner.appendChild(img);
          });
          symbols.forEach(function(symbol) {
            const img = document.createElement("img");
            img.src = symbol;
            reelInner.appendChild(img);
          });
        });
      }
      initReels();
      
      const spinBtn = document.getElementById("spinBtn");
      const resultDiv = document.getElementById("result");
      const prizeImage = document.getElementById("prizeImage");
      const prizeAudio = document.getElementById("prizeAudio");
      const gifBackground = document.getElementById("gifBackground");
      
      // Přehrání mp3 od 1:05 (65 sekund)
      function playPrizeSound() {
        prizeAudio.currentTime = 65;
        prizeAudio.play();
      }
      
      // Funkce, která vytvoří 250 gifů na pozadí (200 + 50 navíc)
      function launchGifs() {
        gifBackground.innerHTML = "";
        gifBackground.style.display = "block";
        for (let i = 0; i < 250; i++) {
          const img = document.createElement("img");
          img.src = "cat.gif"; // Ujistěte se, že tento soubor existuje
          img.style.position = "absolute";
          img.style.top = Math.random() * 100 + "%";
          img.style.left = Math.random() * 100 + "%";
          img.style.width = "50px";
          img.style.height = "50px";
          gifBackground.appendChild(img);
        }
      }
      
      spinBtn.addEventListener("click", function() {
        spinBtn.disabled = true;
        resultDiv.textContent = "";
        prizeImage.style.display = "none";
        gifBackground.style.display = "none";
        reelsFinished = 0;
        spinCount++;
        
        // Spuštění animace pro každý válec
        reelElements.forEach(function(reelInner, index) {
          let finalIndex = Math.floor(Math.random() * symbols.length);
          finalIndices[index] = finalIndex;
          const fullSpins = 5;
          const totalDistance = (fullSpins * symbols.length + finalIndex) * symbolHeight;
          
          reelInner.style.transition = "transform " + (2 + index * 0.5) + "s ease-out";
          reelInner.style.transform = "translateY(-" + totalDistance + "px)";
          
          reelInner.addEventListener("transitionend", function handler() {
            reelInner.style.transition = "none";
            reelInner.style.transform = "translateY(-" + (finalIndex * symbolHeight) + "px)";
            reelInner.removeEventListener("transitionend", handler);
            reelsFinished++;
            if (reelsFinished === reelElements.length) {
              evaluateResult();
            }
          });
        });
      });
      
      // Vyhodnocení výsledku spinů
      function evaluateResult() {
        // Pokud je spinCount mezi 10 a 15, výhra je jistá – nuceně nastavíme stejné symboly
        if (spinCount >= 10 && spinCount <= 15) {
          const forcedIndex = 0; // Můžete zvolit libovolný index
          finalIndices = [forcedIndex, forcedIndex, forcedIndex];
          reelElements.forEach(function(reelInner) {
            reelInner.style.transition = "none";
            reelInner.style.transform = "translateY(-" + (forcedIndex * symbolHeight) + "px)";
          });
          resultDiv.textContent = "Všechno nejlepší!";
          prizeImage.style.display = "block";
          playPrizeSound();
          launchGifs();
        } else if (spinCount < 10) {
          resultDiv.textContent = "Tak ale děleeeej";
        } else {
          // Pro spinCount vyšší než 15 – výhra je jen při shodě všech symbolů
          if (finalIndices[0] === finalIndices[1] && finalIndices[1] === finalIndices[2]) {
            resultDiv.textContent = "Všechno nejlepší!";
            prizeImage.style.display = "block";
            playPrizeSound();
            launchGifs();
          } else {
            resultDiv.textContent = "Tak ale děleeeej";
          }
        }
        spinBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
